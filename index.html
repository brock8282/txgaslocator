<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>KML Click Capture Sample</title>

    <style>
      #map {
      height: 500px;
      }

      html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      }

      input {
      width: 100%;
      padding: 10px 10px;
      font-size: 16px;
      }
    </style>
    <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
  </head>
  <body>

      <div id="map"></div>
      <div class="pac-card" id="pac-card">
      <div id="pac-container">
        <input id="pac-input" type="text" placeholder="Enter a location">
      </div>
      </div>
      <div id="infowindow-content">
        <img src="" width="16" height="16" id="place-icon">
        <span id="place-name"  class="title"></span><br><span id="place-address"></span>
      </div>

      <script src="maps.google.polygon.containsLatLng.js"></script> 
      <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdeqDzFtmXXhPJdVp6BtJgpZiIK4I4ozU&libraries=places&callback=initMap"></script>
      <script>
        
          var map;      
          var src= 'https://cdn2.hubspot.net/hubfs/4826017/mapdata/Montgomery%20County%20Boundary.kml';

          //  var layer2src= 'https://maps-data.nrel.gov/geoserver/nrel/wms?service=WMS&version=1.1.0&request=GetMap&layers=nrel:naturalgas_processingplants_us_2014_v2&styles=&bbox=-121.968086242676,26.3361492156982,-78.512939453125,48.9488830566406&width=768&height=399&srs=EPSG:4326&format=application%2Fvnd.google-earth.kmz%20xml';

          function initMap() {
              map = new google.maps.Map(document.getElementById('map'), {
              center: new google.maps.LatLng(30.2224036, -95.6209387),
              zoom: 12,
              mapTypeId: 'roadmap'
          });

          var kmlLayer = new google.maps.KmlLayer(src, {
              suppressInfoWindows: false,
              preserveViewport: false,
              map: map
          });

          //    var kmlLayer2 = new google.maps.KmlLayer(layer2src, {
          //     suppressInfoWindows: false,
          //     preserveViewport: false,
          //     map: map
          //   });

          kmlLayer.addListener('click', function(event) {
            var content = event.featureData.infoWindowHtml;
            var testimonial = document.getElementById('capture');
                testimonial.innerHTML = content;
          });

          var card = document.getElementById('pac-card');
          var input = document.getElementById('pac-input');
          var types = document.getElementById('type-selector');
          var strictBounds = document.getElementById('strict-bounds-selector');

          var autocomplete = new google.maps.places.Autocomplete(input);
              autocomplete.bindTo('bounds', map);
              autocomplete.setFields(
              ['address_components', 'geometry', 'icon', 'name']);

          var infowindow = new google.maps.InfoWindow();
          var infowindowContent = document.getElementById('infowindow-content');
              infowindow.setContent(infowindowContent);
          var marker = new google.maps.Marker({
              map: map,
              anchorPoint: new google.maps.Point(0, -29)
            });

              autocomplete.addListener('place_changed', function() {
              infowindow.close();
              marker.setVisible(false);

          var place = autocomplete.getPlace();
          var lat = place.geometry.location.lat(),
              lng = place.geometry.location.lng();

              console.log(lat);
              console.log(lng);

          if (!place.geometry) {  
              window.alert("No details available for input: '" + place.name + "'");
                
              return;
          }

          if (place.geometry.viewport) 
          {
            map.fitBounds(place.geometry.viewport);
          }  else 
          {
            map.setCenter(place.geometry.location);
            map.setZoom(17);  
          }
            marker.setPosition(place.geometry.location);
            marker.setVisible(true);

          var address = '';
          if (place.address_components) {
              address = [
                (place.address_components[0] && place.address_components[0].short_name || ''),
                (place.address_components[1] && place.address_components[1].short_name || ''),
                (place.address_components[2] && place.address_components[2].short_name || '')
              ].join(' ');
          }

              infowindowContent.children['place-icon'].src = place.icon;
              infowindowContent.children['place-name'].textContent = place.name;
              infowindowContent.children['place-address'].textContent = address;
              infowindow.open(map, marker);

          var polygon = new google.maps.Polygon([], "#000000", 1, 1, "#336699", 0.3);
          var isWithinPolygon = polygon.containsLatLng(lat,lng);
        });

        function setupClickListener(id, types) {
          var radioButton = document.getElementById(id);
          radioButton.addEventListener('click', function() {
            autocomplete.setTypes(types);
          });
        }

        setupClickListener('changetype-all', []);
        setupClickListener('changetype-address', ['address']);
        setupClickListener('changetype-establishment', ['establishment']);
        setupClickListener('changetype-geocode', ['geocode']);

        document.getElementById('use-strict-bounds')
        .addEventListener('click', function() {
        console.log('Checkbox clicked! New state=' + this.checked);
        autocomplete.setOptions({strictBounds: this.checked});
        });
        }
  </script>    
  </body>
</html>